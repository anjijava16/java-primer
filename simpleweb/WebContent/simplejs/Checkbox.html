<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>checkbox test</title>

<script type="text/javascript" src="../jslib/jquery-1.6.1.js"></script>
<style type="text/css">
.base {
	list-style: none;
	border: 1px solid #000;
	width: 30em;
	margin-left: 2em;
	margin-top: 0px;
	padding-left: 5px;
}

span.all{
	margin-left: 2em;
}
</style>
<script>
	$(document).ready(function (){ 
		new op.addBoxListener();
		new op.addKeyListener();
		new op.selectAll();
	}); 
	
	var op = {
		shiftKey : '',
		selectAllFlag : false,
		addBoxListener : function(){
			//$(':checkbox') is equivalent to $('[type=checkbox]'). 
			var boxs = $(':checkbox:[name="item"]');
			boxs.click(
				function(){
					//alert(op.shiftKey);
					if(op.shiftKey){
						new op.debugInfo('shift key down ' + "  checkbox id is " + this.id);
						//alert(this)
						var currId = parseInt(this.id);
						var nextDownId = currId + 1;
						var flag = 0;
						while(true){
							var nextDownItem = $('#' + nextDownId);
							if(nextDownItem.length == 0){
								break;
							}
							if(nextDownItem[0].checked){
								flag = 1;    //向后遍历，如果有被选中的checkbox,flag 置1;
								break;
							}
							nextDownId++;
						}
						
						if(!flag){
							var prevDownItemId = currId -1;
							while(true){
								var prevDownItem = $('#' + prevDownItemId);
								if(prevDownItem.length == 0){
									break;
								}
								if(prevDownItem[0].checked){
									flag = 2;   ////向前遍历，如果有被选中的checkbox,flag 置2;
									break;
								}
								prevDownItemId--;
							}
						}
						
						var index = 0;
						var initVal = 0;
						switch(flag){
							case 0:
								break;
							case 1:
								index = nextDownId;
								initVal = currId + 1;
								for(var i = initVal; i <= index; i++){
									var item = $('#' + i);
									item[0].checked = true; 
								}
								
								break;
							case 2:
								index = prevDownItemId;
								initVal = currId -1;
								for(var i = initVal; i >= index; i--){
									var item = $('#' + i);
									item[0].checked = true; 
								}
								
						}
					}else{
						new op.debugInfo('not have shift key' + "  checkbox id is " + this.id);
					}
				}
			); 			
		},
		selectAll : function(){
			var itemAll = $('#itemAll');
			itemAll.click(
				function(){
					op.selectAllFlag = !op.selectAllFlag;
					itemAll[0].checked = op.selectAllFlag;
					
				    $("input[type='checkbox']").each(function() {
				    	$(this).attr("checked", op.selectAllFlag);
				  	})					
				}
			);
			
		},
		addKeyListener : function(){
			$(document).keydown(function(event){
				//16 = Shift_L
				if(event.keyCode == 16){
					//new op.debugInfo('keydown-->' + event.keyCode);
					op.shiftKey = true;
				}
			});
			
			$(document).keyup(function(event){
				if(event.keyCode == 16){
					new op.debugInfo('keyup-->' + event.keyCode);
				}
				op.shiftKey = false;
			}); 			
		},
		checkboxScopeSelect : function(){
			//用户用鼠标拖动一个矩形范围，就可以选中，范围内的checkbox.
			/*   
			var x=window.event.clientX;     
			var y=window.event.clientY;     
			var str='';
			
			for(i=0;i<document.body.children.length;i++){     
				var obj=document.body.children[i];     
				if(x>obj.offsetLeft&&x<(obj.offsetLeft+obj.clientWidth)&&y>obj.offsetTop&&y<(obj.offsetTop+obj.clientHeight))  
				{  
				  str+='<鼠标位于层'+obj.id+'范围之内>\n';     
				}else{     
				    str+='<鼠标位于层'+obj.id+'范围之外>\n';     
				}     
			}     
			alert(str);     
			*/     			
		},
		debugInfo : function(text){
			var ul = $('#info')[0];
			var date = new Date();
			//new Date().toLocaleString()->2011年6月14日 17:12:50
			var formatDate = date.toTimeString();
			
			var info = formatDate + ":" + text;
			$("<li/>").css("border","solid 1px #FF0000").html(info).appendTo(ul);
		}
	};
</script>
</head>
<body>
	<span class="all"><input id="itemAll" type="checkbox" name="itemAll"/>全选</span>
	<ul id='ul' class="base">
		<li><input id="1" type="checkbox" name="item"/></li>
		<li><input id="2" type="checkbox" name="item"/></li>
		<li><input id="3" type="checkbox" name="item"/></li>
		<li><input id="4" type="checkbox" name="item"/></li>
		<li><input id="5" type="checkbox" name="item"/></li>
		<li><input id="6" type="checkbox" name="item"/></li>
		<li><input id="7" type="checkbox" name="item"/></li>
		<li><input id="8" type="checkbox" name="item"/></li>
		<li><input id="9" type="checkbox" name="item"/></li>
		<li><input id="10" type="checkbox" name="item"/></li>
		<li><input id="11" type="checkbox" name="item"/></li>
		<li><input id="12" type="checkbox" name="item"/></li>
		<li><input id="13" type="checkbox" name="item"/></li>
		<li><input id="14"  type="checkbox" name="item"/></li>
	</ul>
	<ul id='info' class="base"></ul>
</body>
</html>